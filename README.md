# üöÄ Landing Page Backend API

Backend API em Node.js para processar formul√°rios de contato da landing page, com envio de emails automatizado via Gmail SMTP.

[![Deploy to Render](https://render.com/images/deploy-to-render-button.svg)](https://render.com)

## üìã Funcionalidades

- ‚úÖ **API RESTful** para formul√°rio de contato
- üìß **Envio de emails** via Gmail SMTP com templates HTML
- üõ°Ô∏è **Seguran√ßa robusta** (Rate limiting, valida√ß√£o, sanitiza√ß√£o)
- üåê **CORS configurado** para integra√ß√£o frontend/backend
- ‚ö° **Deploy gratuito** no Render com HTTPS
- üìä **Logs estruturados** e health check
- üîí **Valida√ß√£o rigorosa** de dados de entrada

## üõ†Ô∏è Tecnologias Utilizadas

- **Node.js** + **Express.js** - Framework web
- **Nodemailer** - Envio de emails
- **Express Validator** - Valida√ß√£o de dados
- **Helmet** - Seguran√ßa HTTP
- **Morgan** - Logging de requisi√ß√µes
- **CORS** - Cross-Origin Resource Sharing

## üì¶ Instala√ß√£o e Configura√ß√£o

### 1. Clone o reposit√≥rio
```bash
git clone <seu-repositorio>
cd landingpage-backend
```

### 2. Instale as depend√™ncias
```bash
npm install
```

### 3. Configure as vari√°veis de ambiente
```bash
cp .env.example .env
```

Edite o arquivo `.env` com suas configura√ß√µes:

```env
# Server Configuration
PORT=5000

# CORS Configuration - URL do seu frontend
CLIENT_ORIGIN=https://seu-site.netlify.app

# Email Configuration
SMTP_SERVICE=gmail

# Gmail (remetente)
SMTP_USER=seu_email@gmail.com
SMTP_PASS=sua_senha_de_app_gmail

# Email de destino (Proton Mail para receber)
SMTP_TO=seu_email@proton.me

# Environment
NODE_ENV=development
```

### 4. Execute localmente
```bash
# Desenvolvimento (com nodemon)
npm run dev

# Produ√ß√£o
npm start
```

O servidor estar√° rodando em `http://localhost:5000`

### 4.1. Executar com Docker (Opcional)

```bash
# Build da imagem
docker build -t landingpage-backend .

# Executar container
docker run -d -p 5000:5000 --env-file .env --name landingpage-backend landingpage-backend

# Verificar logs
docker logs landingpage-backend

# Parar container
docker stop landingpage-backend
```

### 4.2. Executar com Docker Compose

```bash
# Iniciar todos os servi√ßos
docker compose up -d

# Verificar status
docker compose ps

# Ver logs
docker compose logs -f landingpage-backend

# Parar todos os servi√ßos
docker compose down
```

## üìß Configura√ß√£o de Email

### üì® **Gmail SMTP** (Remetente - Recomendado)

Para usar Gmail como remetente:

1. **Ative a verifica√ß√£o em duas etapas**:
   - Acesse: https://myaccount.google.com/security
   - Ative "Verifica√ß√£o em duas etapas" (obrigat√≥rio)

2. **Gere uma senha de app**:
   - Acesse: https://myaccount.google.com/apppasswords
   - Selecione "Email" e "Outro (nome personalizado)"
   - Digite "Landing Page" como nome
   - Copie a senha gerada (16 caracteres sem espa√ßos)

3. **Configure as vari√°veis**:
   ```env
   SMTP_SERVICE=gmail
   SMTP_USER=seu_email@gmail.com
   SMTP_PASS=sua_senha_de_app_gmail
   SMTP_TO=seu_email@proton.me
   ```

## üöÄ Deploy em Produ√ß√£o (Gr√°tis)

Seu backend est√° configurado para deploy em **3 plataformas gratuitas**. Recomendamos **Render** por ser mais est√°vel.

### üåü **Render** (Recomendado)

**Vantagens:** HTTPS autom√°tico, logs detalhados, sleep mode inteligente, melhor uptime

1. **Prepare o reposit√≥rio:**
   ```bash
   git init
   git add .
   git commit -m "feat: containerized backend with Docker"
   git remote add origin https://github.com/SEU_USUARIO/landingpage-backend.git
   git push -u origin main
   ```

2. **Deploy no Render:**
   - Acesse: https://render.com
   - Clique "New" ‚Üí "Web Service"
   - Conecte seu reposit√≥rio GitHub
   - Configura√ß√µes autom√°ticas (usa `render.yaml`):
     ```yaml
     Runtime: Docker
     Build Command: (autom√°tico)
     Start Command: (autom√°tico)
     ```

3. **Configure vari√°veis de ambiente:**
   ```bash
   NODE_ENV=production
   CLIENT_ORIGIN=https://arthurjregiani.netlify.app
   SMTP_SERVICE=gmail
   SMTP_USER=arthurjregiani@gmail.com
   SMTP_PASS=sua_senha_de_app_gmail
   SMTP_TO=seu_email@proton.me
   ```

4. **URL final:** `https://landingpage-backend.onrender.com`

### üöÇ **Railway**

**Vantagens:** Deploy mais r√°pido, interface moderna, boa para desenvolvimento

1. **Deploy no Railway:**
   ```bash
   # Instalar CLI (opcional)
   npm install -g @railway/cli
   
   # Ou usar interface web:
   # https://railway.app ‚Üí "Deploy from GitHub"
   ```

2. **Configura√ß√£o autom√°tica via `railway.json`**

3. **Configurar vari√°veis no dashboard Railway**

### ‚úàÔ∏è **Fly.io**

**Vantagens:** Global edge deployment, containers nativos, boa performance

1. **Instalar Fly CLI:**
   ```bash
   # Linux/Mac
   curl -L https://fly.io/install.sh | sh
   ```

2. **Deploy:**
   ```bash
   # Login
   flyctl auth login
   
   # Deploy (usa fly.toml)
   flyctl deploy
   
   # Configurar vari√°veis
   flyctl secrets set SMTP_USER=seu_email@gmail.com
   flyctl secrets set SMTP_PASS=sua_senha_de_app
   # ... outras vari√°veis
   ```

### üìä **Compara√ß√£o das Plataformas**

| Recurso | Render | Railway | Fly.io |
|---------|--------|---------|--------|
| **Pre√ßo** | Gr√°tis | Gr√°tis ($5 cr√©dito) | Gr√°tis |
| **HTTPS** | ‚úÖ Autom√°tico | ‚úÖ Autom√°tico | ‚úÖ Autom√°tico |
| **Logs** | ‚úÖ Excelente | ‚úÖ Bom | ‚úÖ Bom |
| **Uptime** | ‚úÖ Alto | ‚ö†Ô∏è M√©dio | ‚úÖ Alto |
| **Sleep Mode** | ‚ö†Ô∏è Sim (15 min) | ‚ö†Ô∏è Sim (5 min) | ‚úÖ N√£o |
| **Facilidade** | ‚úÖ Muito F√°cil | ‚úÖ F√°cil | ‚ö†Ô∏è Intermedi√°rio |
| **Regi√£o BR** | ‚ùå N√£o | ‚ùå N√£o | ‚úÖ S√£o Paulo |

### üîó **Atualizar URL no Frontend**

Ap√≥s o deploy, atualize a URL no seu `script.js`:

```javascript
// Substitua pela URL real do seu deploy
const BACKEND_URL = 'https://landingpage-backend.onrender.com/api/contact';
// ou
const BACKEND_URL = 'https://seu-app.up.railway.app/api/contact';
// ou 
const BACKEND_URL = 'https://landingpage-backend.fly.dev/api/contact';
```

### üîí **Proton Mail** (Alternativa como Remetente)

Para usar Proton Mail como remetente:

1. **Ative Two-Factor Authentication**:
   - V√° em Settings ‚Üí Go to settings ‚Üí Security ‚Üí Two-factor authentication
   - Configure 2FA (obrigat√≥rio para app passwords)

2. **Crie App Password**:
   - V√° em Settings ‚Üí Go to settings ‚Üí Security ‚Üí App passwords
   - Clique em "Generate app password"
   - Selecione "Mail" como app
   - Copie a senha gerada (16 caracteres)

3. **Configure as vari√°veis**:
   ```env
   SMTP_SERVICE=proton
   SMTP_USER=seu_email@proton.me
   SMTP_PASS=sua_app_password_de_16_caracteres
   SMTP_TO=email_destino@proton.me
   ```

## üåê Deploy no Render (Gratuito)

### Op√ß√£o 1: Deploy Autom√°tico
1. Fa√ßa fork deste reposit√≥rio
2. Conecte sua conta GitHub no [Render](https://render.com)
3. Crie um novo "Web Service"
4. Configure as vari√°veis de ambiente no dashboard

### Op√ß√£o 2: Deploy via render.yaml
O arquivo `render.yaml` j√° est√° configurado. Apenas:
1. Fa√ßa push para o reposit√≥rio
2. Configure as vari√°veis de ambiente no dashboard do Render

### Vari√°veis de Ambiente no Render
Configure estas vari√°veis no dashboard:

**Gmail ‚Üí Proton Mail (Recomendado):**
```
NODE_ENV=production
CLIENT_ORIGIN=https://seu-frontend-domain.com
SMTP_SERVICE=gmail
SMTP_USER=seu_email@gmail.com
SMTP_PASS=sua_senha_de_app_gmail
SMTP_TO=seu_email@proton.me
```

**Proton Mail ‚Üí Gmail (Alternativa):**
```
NODE_ENV=production
CLIENT_ORIGIN=https://seu-frontend-domain.com
SMTP_SERVICE=proton
SMTP_USER=seu_email@proton.me
SMTP_PASS=sua_app_password_proton
SMTP_TO=seu_gmail@gmail.com
```

## üìù API Reference

### Health Check
```http
GET /health
```

**Response:**
```json
{
  "status": "OK",
  "timestamp": "2025-09-21T02:19:50.000Z",
  "uptime": 123.456,
  "service": "Landing Page Contact API"
}
```

### Enviar Mensagem de Contato
```http
POST /api/contact
```

**Body:**
```json
{
  "name": "Jo√£o Silva",
  "email": "joao@exemplo.com", 
  "message": "Ol√°! Gostaria de saber mais sobre seus servi√ßos."
}
```

**Response (Success):**
```json
{
  "success": true,
  "message": "Mensagem enviada com sucesso! Retornaremos em breve.",
  "messageId": "<message-id@gmail.com>"
}
```

**Response (Error):**
```json
{
  "success": false,
  "message": "Dados inv√°lidos",
  "errors": [
    {
      "field": "name",
      "message": "Nome √© obrigat√≥rio",
      "value": ""
    }
  ]
}
```

### Info do Endpoint
```http
GET /api/contact
```

Retorna informa√ß√µes sobre a API de contato.

## üîí Seguran√ßa

- **Rate Limiting**: 100 requisi√ß√µes por 15 minutos por IP
- **Helmet.js**: Headers de seguran√ßa HTTP
- **Valida√ß√£o rigorosa**: Sanitiza√ß√£o de todos os inputs
- **CORS configurado**: Apenas origens autorizadas
- **Logs estruturados**: Para monitoramento e debug
- **Container security**: Execu√ß√£o em ambiente isolado

## üìä Monitoramento e Logs

### **Render**
```bash
# Ver logs em tempo real no dashboard
# Ou via CLI:
npx @render/cli logs --service landingpage-backend --follow
```

### **Railway**
```bash
# Ver logs no dashboard Railway
# Ou via CLI:
railway logs --follow
```

### **Fly.io**
```bash
# Ver logs
flyctl logs

# Monitorar em tempo real
flyctl logs --follow

# Status da aplica√ß√£o
flyctl status
```

### **Health Check**
Todas as plataformas monitoram automaticamente via `/health`:
```bash
curl https://sua-app.onrender.com/health
# Resposta: {"status":"OK","timestamp":"...","uptime":123}
```

## üß™ Testando a API

### Com curl:
```bash
curl -X POST https://seu-backend.onrender.com/api/contact \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Teste",
    "email": "teste@exemplo.com",
    "message": "Mensagem de teste do sistema"
  }'
```

### Com Postman:
1. M√©todo: `POST`
2. URL: `https://seu-backend.onrender.com/api/contact`
3. Headers: `Content-Type: application/json`
4. Body: JSON com name, email, message

## üîß Integra√ß√£o Frontend

Atualize seu JavaScript no frontend:

```javascript
const form = document.querySelector('form');

form.addEventListener('submit', async (e) => {
  e.preventDefault();
  
  const formData = new FormData(e.target);
  const data = {
    name: formData.get('name'),
    email: formData.get('email'),
    message: formData.get('message')
  };
  
  try {
    const response = await fetch('https://seu-backend.onrender.com/api/contact', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(data)
    });
    
    const result = await response.json();
    
    if (result.success) {
      alert('‚úÖ ' + result.message);
      e.target.reset();
    } else {
      alert('‚ùå ' + result.message);
    }
  } catch (error) {
    alert('‚ùå Erro ao enviar mensagem. Tente novamente.');
  }
});
```

## üìä Logs e Monitoramento

O sistema gera logs estruturados:
- ‚úÖ Tentativas de contato (nome e email)
- üìß Emails enviados com sucesso
- ‚ùå Erros de valida√ß√£o e envio
- üîí Rate limiting ativado

## üêõ Troubleshooting

### üìß **Email n√£o est√° sendo enviado**
1. **Verifique credenciais Gmail:**
   ```bash
   # Certifique-se de que SMTP_USER e SMTP_PASS est√£o corretos
   # SMTP_PASS deve ser a "senha de app" de 16 caracteres
   ```
2. **Teste localmente:**
   ```bash
   curl -X POST http://localhost:5000/api/contact \
     -H "Content-Type: application/json" \
     -d '{"name":"Teste","email":"teste@example.com","message":"Teste"}'
   ```
3. **Verifique logs da plataforma**

### üåê **CORS Error no Frontend**
1. **Configure CLIENT_ORIGIN corretamente:**
   ```bash
   # ‚ùå Errado
   CLIENT_ORIGIN=meusite.com
   CLIENT_ORIGIN=https://meusite.com/
   
   # ‚úÖ Correto  
   CLIENT_ORIGIN=https://meusite.com
   ```
2. **Para desenvolvimento local:**
   ```bash
   CLIENT_ORIGIN=http://localhost:3000
   ```

### üö´ **Rate Limit ativado**
```bash
# Limite padr√£o: 100 requests per 15 minutos por IP
# Para aumentar temporariamente, edite server.js:

const limiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 minutos
  max: 200, // ‚Üê Aumentar aqui
});
```

### üê≥ **Problemas com Docker**

**Build falhando:**
```bash
# Limpar cache Docker
docker system prune -af

# Build com logs detalhados
docker build --no-cache --progress=plain -t landingpage-backend .
```

**Container n√£o inicia:**
```bash
# Ver logs do container
docker logs landingpage-backend

# Executar interativamente para debug
docker run -it --rm landingpage-backend sh
```

### üöÄ **Problemas no Deploy**

**Render:**
```bash
# 1. Verificar se render.yaml est√° correto
# 2. Checar vari√°veis de ambiente no dashboard
# 3. Ver logs: Dashboard ‚Üí Service ‚Üí Logs
```

**Railway:**
```bash
# 1. Verificar railway.json
# 2. Checar build logs no dashboard
# 3. Testar health check: https://seu-app.up.railway.app/health
```

**Fly.io:**
```bash
# Debug deploy
flyctl deploy --verbose

# Verificar status
flyctl status

# Ver configura√ß√£o
flyctl config show
```

### üìã **Logs √öteis**

```bash
# Logs que indicam sucesso:
"‚úÖ Servidor de email configurado com sucesso"
"üìß Email enviado com sucesso: <message-id>"
"üöÄ Servidor rodando na porta X"

# Logs de erro comuns:
"‚ùå Erro na configura√ß√£o do email: Invalid login"
"‚ùå Missing credentials for PLAIN"
"CORS Error: Access to fetch blocked"
```

## ü§ù Contribuindo

1. Fork o projeto
2. Crie uma branch: `git checkout -b feature/nova-funcionalidade`
3. Commit: `git commit -m 'Adiciona nova funcionalidade'`
4. Push: `git push origin feature/nova-funcionalidade`
5. Abra um Pull Request

## üìÑ Licen√ßa

Este projeto est√° sob a licen√ßa ISC. Veja o arquivo [LICENSE](LICENSE) para detalhes.

## üë®‚Äçüíª Autor

**Arthur J. Regiani**
- GitHub: [@Arthurregiani](https://github.com/Arthurregiani)
- Email: arthurregiani@gmail.com

---

‚≠ê **Feito com carinho para facilitar o contato entre voc√™ e seus clientes!**